<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data analyst Registration</title>
    <link rel="stylesheet" href="./css/selectProgram.css">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
    <nav id="navbar">
        <img src="./Images/internZzeLogo.png" alt="">
    </nav>

    <div id="formAndCardHolder">
        <div id="CardHolder" data-aos="fade-down">
            <img src="./Images/Data_analyst.jpg" alt="">
            <h2>Data Analyst</h2>
            <div id="priceHolder">
                <h3 id="course-price">Course price: <span id="price">499</span>/-</h3>
                <select id="contentDropdown">
                    <option value="">See Content</option>
                    <option value="Hands-on Experience">Week 1: Foundations of Data Visualization
                    </option>
                    <option value="Live Projects">Weeek 2: Interactive Visualizations with Plotly
                    </option>
                    <option value="Certificate">Week 3: Power BI - Business Intelligence Visualizations
                    </option>
                    <option value="Career Guidance">Week 4: Tableau - Advanced Visualizations & Dashboards
                    </option>
                </select>
            </div>
            <ul>
                <li>Hands On Industry Experience</li>
                <li>Live Projects and real-world Exposure</li>
                <li>Certificate of Completion</li>
                <li>Opportunity for rewards and prizes</li>
                <li>Career Guidence and mentorship</li>
            </ul>

            <button id="pay-button">Buy Now</button>
        </div>

        <div id="FormContainer" data-aos="fade-down">
            <h1>Register YourSelf</h1>

            <form action="">
                <input type="text" name="name" id="name" placeholder="Enter your name">
                <input type="email" name="email" id="email" placeholder="Enter your Email">
                <input type="text" name="number" id="number" placeholder="Enter your number">
                <input type="text" name="college" id="college" placeholder="Enter your college name">
                <input type="text" name="linkedin" id="linkedin" placeholder="Enter link of linkedin profile[Optional]">
                <select id="program">
                    <option value="">Choose the Program</option>
                    <option value="Use of AI Tool">Use of AI Tool
                    </option>
                    <option value="Web Development">Web Development
                    </option>
                    <option value="Data Analytics">Data Analytics
                    </option>
                    <option value="How to Build the startup">How to Build the startup
                    </option>
                </select>
                <input type="text" name="github" id="github" placeholder="Enter link of github account[Optional]">
                <textarea name="description" id="description" placeholder="why are you interested to do this program"></textarea>

                <div id="refferHolder">
                    <label for="referral">Referral Code:</label>
                    <input type="text" name="referral" id="referral">
                </div>

                <div class="termsHolder">
                    <input type="checkbox" name="term1" id="term1">
                    <label for="tem1">Accept Terms & Condition</label>
                </div>

                <button type="submit">Register</button>
            </form>
        </div>
    </div>


    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        AOS.init({
            offset: 200,
            duration: 1000
        });


    </script>



<script>
//     document.getElementById("pay-button").addEventListener("click", async function () {
//     try {
//         const priceElement = document.getElementById("price"); // Get the displayed price
//         let price = parseInt(priceElement.textContent.replace("/-", "").trim()); // Extract numeric value

//         if (isNaN(price) || price <= 0) {
//             alert("Invalid price!");
//             return;
//         }

//         // Create Order
//         const response = await fetch("http://localhost:3000/create-order", {
//             method: "POST",
//             headers: { "Content-Type": "application/json" },
//             body: JSON.stringify({ amount: price * 100 })
//         });
        
//         const data = await response.json();
//         console.log(data)
//         if (!data.success) throw new Error("Order creation failed");

//         // Open Razorpay Checkout
//         const options = {
//             key: "rzp_live_rly0BJKgu8Z5zG",  // Replace with your Razorpay key
//             amount: data.order.amount,
//             currency: data.order.currency,
//             name: "AI Course",
//             description: "Purchase AI Course",
//             order_id: data.order.id,
//             payment_capture: 1, // Ensure automatic capture of payments
//             method: {
//                 netbanking: true,
//                 card: true,
//                 upi: true,  // Enable UPI explicitly
//                 wallet: true
//             },
//             prefill: {
//                 name: document.getElementById("name").value,  // Get user details
//                 email: document.getElementById("email").value,
//                 contact: document.getElementById("number").value
//             },
//             handler: async function (response) {
//                 const verifyResponse = await fetch("http://localhost:3000/verify-payment", {
//                     method: "POST",
//                     headers: { "Content-Type": "application/json" },
//                     body: JSON.stringify(response),
//                 });

//                 const verifyData = await verifyResponse.json();
//                 if (verifyData.success) {
//                     alert("Payment Successful!");
//                 } else {
//                     alert("Payment Verification Failed!");
//                 }
//             },
//             theme: { color: "#3399cc" },
//         };

//         const razorpay = new Razorpay(options);
//         razorpay.open();
//     } catch (error) {
//         console.error(error);
//         alert("Something went wrong!");
//     }
// });









document.getElementById("pay-button").addEventListener("click", async function () {
    try {
        console.log("Button clicked, starting process...");
        const priceElement = document.getElementById("price");
        let price = parseInt(priceElement.textContent.replace("/-", "").trim());
        console.log("Price:", price);

        if (isNaN(price) || price <= 0) {
            alert("Invalid price!");
            return;
        }

        console.log("Creating order...");
        const response = await fetch("https://internzze.com/api/create-order", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ amount: price * 100 })
        });
        
        const data = await response.json();
        console.log("Order data:", data);
        if (!data.success) throw new Error("Order creation failed");

        console.log("Setting up options...");
        const nameInput = document.getElementById("name");
        const emailInput = document.getElementById("email");
        const numberInput = document.getElementById("number");
        console.log("Inputs - Name:", nameInput, "Email:", emailInput, "Number:", numberInput);

        const options = {
            key: "rzp_live_rly0BJKgu8Z5zG", // Switch to test key for now
            amount: data.order.amount,
            currency: data.order.currency,
            name: "Data analyst",
            description: "Purchase Data analyst course",
            order_id: data.order.id,
            payment_capture: 1,
            method: {
                netbanking: true,
                card: true,
                upi: true,
                wallet: true
            },
            prefill: {
                name: nameInput ? nameInput.value : "",
                email: emailInput ? emailInput.value : "",
                contact: numberInput ? numberInput.value : ""
            },
            handler: async function (response) {
                console.log("Handler triggered with response:", response);
                try {
                    const verifyResponse = await fetch("https://internzze.com/api/verify-payment", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(response),
                    });
                    const verifyData = await verifyResponse.json();
                    console.log("Verification result:", verifyData);
                    if (verifyData.success) {
                        alert("Payment Successful!");
                        window.location.href = "DataSocialMedia.html";
                    } else {
                        alert("Payment Verification Failed!");
                    }
                } catch (error) {
                    console.error("Verification error:", error);
                }
            },
            modal: {
                ondismiss: function () {
                    console.log("Payment modal closed by user");
                }
            },
            config: {
                display: {
                    hide: [
                        { method: "upi", flows: ["qr"] } // Explicitly hide QR flow for UPI
                    ],
                    blocks: {
                        upi: {
                            name: "Pay via UPI",
                            instruments: [
                                {
                                    method: "upi",
                                    flows: ["collect"] // Only allow manual UPI ID entry
                                }
                            ]
                        },
                        banks: {
                            name: "Other Payment Methods",
                            instruments: [
                                { method: "card" },
                                { method: "netbanking" },
                                { method: "wallet" }
                            ]
                        }
                    },
                    sequence: ["block.upi", "block.banks"],
                    preferences: {
                        show_default_blocks: false // Use custom blocks only
                    }
                }
            },
            timeout: 300,
            notes: {
                upi_intent: true // Enable UPI intent flow
            },
            theme: { color: "#3399cc" }
        };

        console.log("Options created:", options);
        console.log("Order ID:", data.order.id);
        console.log("Using key:", options.key);
        if (data.order.id.includes("TEST") && options.key.includes("live")) {
            alert("⚠️ Key mismatch: Test order with live key!");
        }

        if (typeof Razorpay === "undefined") {
            throw new Error("Razorpay SDK not loaded!");
        }
        console.log("Opening Razorpay...");
        const razorpay = new Razorpay(options);
        razorpay.on("payment.failed", function (response) {
            console.log("Payment failed:", response.error);
            alert("Payment failed: " + response.error.description);
        });

        razorpay.on("payment.pending", function (response) {
            console.log("Payment pending:", response);
            alert("UPI QR payment is pending. Please scan the QR code and approve in your UPI app.");
        });

        razorpay.on("payment.authorized", function (response) {
            console.log("Payment authorized:", response);
        });
        razorpay.open();
    } catch (error) {
        console.error("Error:", error);
        alert("Something went wrong: " + error.message);
    }
});

</script>




    <script src="script.js"></script>
</body>
</html>